'use strict';
const createTempStyleSheet = require('./createTempStyleSheet');

function getCorsFreeStyleSheet(cssArrayBuffer, styleSheet) {
  let corsFreeStyleSheet;
  if (styleSheet) {
    try {
      styleSheet.cssRules;
      corsFreeStyleSheet = styleSheet;
    } catch (e) {
      console.log(
        `[dom-snapshot] could not access cssRules for ${styleSheet.href} ${e}\ncreating temp style for access.`,
      );
      corsFreeStyleSheet = createTempStyleSheet(cssArrayBuffer);
    }
  } else {
    corsFreeStyleSheet = createTempStyleSheet(cssArrayBuffer);
  }

  return {corsFreeStyleSheet, cleanStyleSheet};

  function cleanStyleSheet() {
    if (corsFreeStyleSheet !== styleSheet) {
      corsFreeStyleSheet.ownerNode.parentNode.removeChild(corsFreeStyleSheet.ownerNode);
    }
  }
}

module.exports = getCorsFreeStyleSheet;
